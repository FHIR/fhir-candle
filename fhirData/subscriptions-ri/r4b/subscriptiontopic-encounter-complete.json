{
  "resourceType": "SubscriptionTopic",
  "id": "encounter-complete",
  "url": "http://example.org/FHIR/SubscriptionTopic/encounter-complete",
  "version": "1.0.0-fhir.r4b",
  "title": "encounter-complete",
  "status": "draft",
  "date": "2019-01-01",
  "description": "Example topic for completed encounters",
  "resourceTrigger": [
    {
      "description": "An Encounter has been completed",
      "resource": "http://hl7.org/fhir/StructureDefinition/Encounter",
      "supportedInteraction": [
        "create",
        "update"
      ],
      "queryCriteria": {
        "previous": "status:not=completed",
        "resultForCreate": "test-passes",
        "current": "status=completed",
        "resultForDelete": "test-fails",
        "requireBoth": true
      },
      "fhirPathCriteria": "(%previous.empty() | (%previous.status != 'completed')) and (%current.status = 'completed')"
    }
  ],
  "canFilterBy": [
    {
      "description": "Filter based on the subject of an encounter.",
      "resource": "Encounter",
      "filterParameter": "subject"
    },
    {
      "description": "Filter based on the group membership of the subject of an encounter.",
      "resource": "Encounter",
      "filterParameter": "_in"
    },
    {
      "description": "Filter based on the length of an encounter.",
      "resource": "Encounter",
      "filterParameter": "length",
      "modifier": [
        "gt",
        "lt",
        "ge",
        "le"
      ]
    }
  ],
  "notificationShape": [
    {
      "resource": "Encounter",
      "include": [
        "Encounter:patient&iterate=Patient.link",
        "Encounter:practitioner",
        "Encounter:service-provider",
        "Encounter:account",
        "Encounter:diagnosis",
        "Encounter:observation",
        "Encounter:location"
      ]
    }
  ]
}